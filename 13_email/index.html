<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>13. Email - Django</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "13. Email";
    var mkdocs_page_input_path = "13_email.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Django</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../00_por_que_django/">¿Por qué Django?</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../01_introduccion/">1. Introducción</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../02_configuracion_inicial/">2. Configuración Inicial</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../03_hello_world_app/">3. Hello World app</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../04_pages_app/">4. Pages app</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../05_message_board_app/">5. Message Board app</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../06_blog_app/">6. Blog app</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../07_formularios/">7. Formularios</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../08_cuentas_de_usuarios/">8. Cuentas de Usuarios</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../09_modelo_de_usuario_personalizado/">9. Modelo de Usuario Personalizado</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../10_autenticacion_de_usuarios/">10. Autenticación de Usuarios</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../11_bootstrap/">11. Bootstrap</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../12_cambio_y_restauracion_de_contrasenas/">12. Cambio y Restauración de Contraseñas</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">13. Email</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#131-sendgrid">13.1. SendGrid</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#132-correos-electronicos-personalizados">13.2. Correos electrónicos personalizados</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#133-conclusion">13.3. Conclusión</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../14_newspaper_app/">14. Newspaper app</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../15_permisos_y_autorizacion/">15. Permisos y Autorización</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../16_comentarios/">16. Comentarios</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../17_docker/">17. Docker</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Django</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>13. Email</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="13-correo-electronico">13. Correo electrónico</h1>
<p>Ahora se quiere que los correos electrónicos se envíen realmente a los usuarios, no sólo a la consola de línea de comandos.</p>
<p>Se precisa de una <em>SendGrid</em> y actualizar los archivos <code>settings.py</code>. Django se encargará del resto.</p>
<h2 id="131-sendgrid">13.1. SendGrid</h2>
<p><a href="https://sendgrid.com/"><em>SendGrid</em></a> es un servicio popular para el envío de e-mails transaccionales. A Django no le importa el servicio que se elija; se puede usar también <a href="https://www.mailgun.com/"><em>MailGun</em></a> o cualquier otro servicio con la misma facilidad.</p>
<ul>
<li>En la página de inicio de <em>SendGrid</em>, hacer clic en "<a href="https://signup.sendgrid.com/">Start for Free</a>".</li>
<li>Registrarse para obtener su cuenta gratuita en la siguiente página.</li>
<li>Asegurarse de que la cuenta de correo electrónico que se utiliza para <em>SendGrid</em> <strong>no sea la misma cuenta de correo electrónico que se tiene para la cuenta de superusuario</strong> en el proyecto de Newspaper o pueden suceder errores extraños.</li>
<li>Luego de confirmar la nueva cuenta a través de un correo electrónico, se pedirá que se ingrese y nos llevará a la página del panel de control de <em>SendGrid</em>.</li>
<li>Ahora podemos configurar el código Django en el archivo <code>settings.py</code>. Primero se actualizará el backend de correo electrónico para usar SMTP.</li>
</ul>
<p>FICHERO: <code>newspaper_project/settings.py</code></p>
<pre><code class="language-python">EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
</code></pre>
<ul>
<li>Luego, justo debajo, agregar las siguientes cinco líneas de configuración de correo electrónico. Tener en cuenta que lo ideal sería almacenar información segura como la contraseña en variables de entorno, pero no estamos aquí para mantener las cosas simples.</li>
</ul>
<p>FICHERO: <code>newspaper_project/settings.py</code></p>
<pre><code class="language-python">DEFAULT_FROM_EMAIL = '&lt;email&gt;'
EMAIL_HOST = 'smtp.sendgrid.net'
EMAIL_HOST_USER = 'apikey'
EMAIL_HOST_PASSWORD = '&lt;password apikey&gt;'
EMAIL_PORT = 587
EMAIL_USE_TLS = True
</code></pre>
<ul>
<li>Asegúrarse de usar el nombre de usuario SendGrid para EMAIL_HOST_USER y
la contraseña de EMAIL_HOST_PASSWORD.</li>
<li>Eso es todo.</li>
</ul>
<h2 id="132-correos-electronicos-personalizados">13.2. Correos electrónicos personalizados</h2>
<ul>
<li>Utilizar la barra de búsqueda de <a href="https://github.com/django/django">Github</a> e introducir algunas palabras del texto del correo electrónico. Si se escribe "<em>You're receiving this email because</em>" se terminará en una página muy concreta de Github.</li>
<li>El primer resultado es el que se desea. Muestra que el código se encuentra en <code>django/contrib/admin/templates/registration/password_reset_email.html</code>. Eso significa que en la app <code>contrib</code> el archivo que queremos se llama <code>password_reset_email.html</code>.</li>
</ul>
<p>Aquí está el texto por defecto del código fuente de Django.</p>
<pre><code class="language-html">{% load i18n %}{% autoescape off %}
{% blocktrans %}You're receiving this email because you requested a password reset for your user account at {{ site_name }}.{% endblocktrans %}

{% trans &quot;Please go to the following page and choose a new password:&quot; %}
{% block reset_link %}
{{ protocol }}://{{ domain }}{% url 'password_reset_confirm' uidb64=uid token=token %}
{% endblock %}
{% trans &quot;Your username, in case you've forgotten:&quot; %} {{ user.get_username }}

{% trans &quot;Thanks for using our site!&quot; %}

{% blocktrans %}The {{ site_name }} team{% endblocktrans %}

{% endautoescape %}
</code></pre>
<ul>
<li>Para cambiarlo, se necesita crear un nuevo archivo <code>password_reset_email.html</code> en la carpeta <code>registration</code>.</li>
</ul>
<pre><code class="language-bash">(news) $ touch templates/registration/password_reset_email.html
</code></pre>
<ul>
<li>Usar el siguiente código que ajusta lo que Django proporcionó por defecto.</li>
</ul>
<p>FICHERO: <code>templates/registration/password_reset_email.html</code></p>
<pre><code class="language-html">{% load i18n %}{% autoescape off %}
{% trans &quot;Hi&quot; %} {{ user.get_username }},

{% trans &quot;We've received a request to reset your password. If you didn't make this request, you can safely ignore this email. Otherwise, click the button below to reset your password.&quot; %}

{% block reset_link %}
{{ protocol }}://{{ domain }}{% url 'password_reset_confirm' uidb64=uid token=token %}
{% endblock %}
{% endautoescape %}
</code></pre>
<ul>
<li>Arriba se carga la etiqueta de la plantilla i18n lo que significa que este texto puede ser traducido a varios idiomas. Django tiene un sólido soporte de internacionalización aunque cubrirlo está fuera de nuestro alcance, por ahora.</li>
<li>Se saluda al usuario por su nombre gracias a <code>user.get_username</code>. Luego se usa el bloque <code>reset_link</code> incorporado para incluir el enlace URL personalizado.</li>
<li>También se actualiza el título del asunto del correo electrónico. Para ello, se crea un nuevo archivo <code>templates/registration/password_reset_subject.txt</code>.</li>
</ul>
<pre><code class="language-bash">(news) $ touch templates/registration/password_reset_subject.txt
</code></pre>
<ul>
<li>Luego agregar la siguiente línea de código al archivo <code>password_reset_subject.txt</code>.</li>
</ul>
<pre><code class="language-text">Please reset your password
</code></pre>
<h2 id="133-conclusion">13.3. Conclusión</h2>
<p>Se ha terminado de implementar un flujo de autenticación de usuario completo. Los usuarios pueden ingresar una nueva cuenta, iniciar sesión, cerrar sesión, cambiar contraseña y restablecerla.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../14_newspaper_app/" class="btn btn-neutral float-right" title="14. Newspaper app">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../12_cambio_y_restauracion_de_contrasenas/" class="btn btn-neutral" title="12. Cambio y Restauración de Contraseñas"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../12_cambio_y_restauracion_de_contrasenas/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../14_newspaper_app/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
