<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>12. Cambio y Restauración de Contraseñas - Django</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "12. Cambio y Restauraci\u00f3n de Contrase\u00f1as";
    var mkdocs_page_input_path = "12_cambio_y_restauracion_de_contrasenas.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Django</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../00_por_que_django/">¿Por qué Django?</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../01_introduccion/">1. Introducción</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../02_configuracion_inicial/">2. Configuración Inicial</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../03_hello_world_app/">3. Hello World app</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../04_pages_app/">4. Pages app</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../05_message_board_app/">5. Message Board app</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../06_blog_app/">6. Blog app</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../07_formularios/">7. Formularios</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../08_cuentas_de_usuarios/">8. Cuentas de Usuarios</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../09_modelo_de_usuario_personalizado/">9. Modelo de Usuario Personalizado</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../10_autenticacion_de_usuarios/">10. Autenticación de Usuarios</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../11_bootstrap/">11. Bootstrap</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">12. Cambio y Restauración de Contraseñas</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#121-cambio-de-contrasena">12.1. Cambio de contraseña</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#122-personalizar-el-cambio-de-contrasena">12.2. Personalizar el cambio de contraseña</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#123-restablecer-la-contrasena">12.3. Restablecer la contraseña</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#124-plantillas-personalizadas">12.4. Plantillas personalizadas</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#125-conclusion">12.5. Conclusión</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../13_email/">13. Email</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../14_newspaper_app/">14. Newspaper app</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../15_permisos_y_autorizacion/">15. Permisos y Autorización</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../16_comentarios/">16. Comentarios</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Django</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>12. Cambio y Restauración de Contraseñas</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="12-cambio-y-restauracion-de-contrasenas">12. Cambio y Restauración de Contraseñas</h1>
<p>Así como Django viene con vistas y urls incorporadas para el inicio y cierre de sesión, también viene con vistas/urls para el cambio y el restablecimiento de la contraseña.</p>
<p>Inicialmente implementaremos las vistas y URLs integradas en Django tanto para el cambio de contraseña como para el cambio de contraseña antes de personalizarlas con nuestras propias plantillas y servicios de correo electrónico basados en Bootstrap.</p>
<h2 id="121-cambio-de-contrasena">12.1. Cambio de contraseña</h2>
<p>Django proporciona una implementación predeterminada que ya funciona para este cometido.</p>
<p>Para probarlo:</p>
<ul>
<li>Hacer clic en el botón "Login" para asegurar que se ha iniciado sesión.</li>
<li>Luego navegar a la página "Password change" en http://127.0.0.1:8000/users/password_change/</li>
<li>Introducir la antigua contraseña y luego una nueva. Luego hacer clic en el botón "Change My Password".</li>
<li>Se será redirigido a la página "Password change successful" ubicada en:
http://127.0.0.1:8000/users/password_change/done/.</li>
</ul>
<h2 id="122-personalizar-el-cambio-de-contrasena">12.2. Personalizar el cambio de contraseña</h2>
<p>Se van a personalizar estas dos páginas de cambio de contraseña para que coincidan con el aspecto y la sensación del sitio del periódico.</p>
<p>Dado que Django ya ha creado las vistas y las URL, sólo hay que añadir nuevas plantillas.</p>
<p>Crear dos nuevos archivos de plantillas en la carpeta de registro.</p>
<pre><code class="language-bash">(news) $ touch templates/registration/password_change_form.html
(news) $ touch templates/registration/password_change_done.html
</code></pre>
<p>Actualiza password_change_form.html con el siguiente código.</p>
<p>FICHERO: <code>templates/registration/password_change_form.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block title %}Cambio de Contraseña{% endblock %}

{% block content %}
  &lt;h1&gt;Cambio de Contraseña&lt;/h1&gt;
  &lt;p&gt;Introduzca su antigua contraseña, por seguridad, y luego la nueva dos veces para verificar que se ha escrito correctamente.&lt;/p&gt;
  &lt;form method=&quot;POST&quot;&gt;
    {% csrf_token %}
    {{ form.as_p }}
    &lt;input class=&quot;btn btn-success&quot; type=&quot;submit&quot; value=&quot;Cambiar Contraseña&quot;&gt;
  &lt;/form&gt;
{% endblock %}
</code></pre>
<p>En la parte superior se extiende <code>base.html</code> y se fija el título de la página. Debido a que se usan títulos "blocks" en el archivo <code>base.html</code> se puede prescindir de ellos aquí. El formulario usa POST ya que se están enviando datos y un <code>csrf_token</code> por razones de seguridad. Usando <code>form.as_p</code> estamos simplemente mostrando en párrafos el contenido del formulario de restablecimiento de contraseña por defecto. Y finalmente incluimos un botón de envío que usa el estilo <code>btn btn-success</code> de Bootstrap para que sea verde.</p>
<p>Lo siguiente es la plantilla <code>password_change_done</code>.</p>
<p>FICHERO: <code>templates/registration/password_change_done.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block title %}Cambio de Contraseña Exitoso{% endblock %}

{% block content %}
  &lt;h1&gt;Cambio de Contraseña exitoso&lt;/h1&gt;
  &lt;p&gt;Su contraseña ha cambiado.&lt;/p&gt;
{% endblock content %}
</code></pre>
<p>También se extiende <code>base.html</code> y se incluye un nuevo título. Sin embargo, no hay ningún formulario en la página, sólo texto nuevo.</p>
<p>La nueva página está en http://127.0.0.1:8000/accounts/password_change/done/.</p>
<h2 id="123-restablecer-la-contrasena">12.3. Restablecer la contraseña</h2>
<p>La única configuración que se requiere es decirle a Django cómo enviar los correos electrónicos. Después de todo, un usuario sólo puede restablecer una contraseña si se tiene acceso al correo electrónico vinculado a la cuenta. En producción se usará el servicio de correo electrónico <code>SendGrid</code> para enviar realmente los correos electrónicos, pero para fines de prueba se puede confiar en la configuración del backend de la consola de Django que envía el texto del correo electrónico a la consola de línea de comandos en su lugar.</p>
<p>En la parte inferior del archivo <code>settings.py</code> hacer el siguiente cambio de una línea.</p>
<p>FICHERO: <code>newspaper_project/settings.py</code></p>
<pre><code class="language-python">EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'
</code></pre>
<p>Listo. Django se encargará del resto. Probar desde http://127.0.0.1:8000/accounts/password_reset/.</p>
<p>Asegurar que la dirección de correo electrónico coincida con una de las cuentas de usuario. Una vez enviado, se será redirigido a la página de restablecimiento de contraseña en http://127.0.0.1:8000/accounts/password_reset/done/ que informa de que se revise el correo electrónico. Ya que se le ha dicho a Django que envíe correos electrónicos a la consola de la línea de comando, el texto del correo electrónico estará ahora allí. Esto es lo que se muestra por consola:</p>
<pre><code class="language-tex">Content-Type: text/plain; charset=&quot;utf-8&quot;
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
Subject: =?utf-8?q?Contrase=C3=B1a_restablecida_en_127=2E0=2E0=2E1=3A8000?=
From: webmaster@localhost
To: testuser2@gmail.com
Date: Wed, 24 Feb 2021 19:08:41 -0000
Message-ID: &lt;161419372146.227460.6264007619116440451@padre&gt;


Ha recibido este correo electrónico porque ha solicitado restablecer la contraseña para su cuenta en 127.0.0.1:8000.

Por favor, vaya a la página siguiente y escoja una nueva contraseña.

http://127.0.0.1:8000/accounts/reset/NA/ail96h-fc019327b99befed62950c6dc526e12b/

Su nombre de usuario, en caso de que lo haya olvidado: testuser2

¡Gracias por usar nuestro sitio!

El equipo de 127.0.0.1:8000
</code></pre>
<p>El texto del correo electrónico debe ser idéntico excepto por tres líneas:
- El "To:" en la sexta línea contiene la dirección de correo electrónico del usuario
- El enlace URL contiene una señal segura que Django genera aleatoriamente y puede ser usada sólo una vez
- Django recuerda amablemente el nombre de usuario</p>
<ul>
<li>El enlace proporcionado: http://127.0.0.1:8000/users/reset/MQ/4up-678712c114db2ead7780/, conduce a la "change password page".</li>
<li>Introducir una nueva contraseña y hacer clic en el botón "Change my password". El paso final es ser redirigido a la página de "Password reset complete". </li>
</ul>
<p>Comprobar que todo ha funcionado, hacer clic en el enlace "Login" y usar la nueva contraseña.</p>
<h2 id="124-plantillas-personalizadas">12.4. Plantillas personalizadas</h2>
<p>Sólo hay que crear nuevas plantillas para personalizar el aspecto y la sensación del restablecimiento de la contraseña.</p>
<p>Crear cuatro nuevos archivos de plantilla:</p>
<pre><code class="language-bash">(news) $ touch templates/registration/password_reset_form.html
(news) $ touch templates/registration/password_reset_done.html
(news) $ touch templates/registration/password_reset_confirm.html
(news) $ touch templates/registration/password_reset_complete.html
</code></pre>
<p>Se empieza con el formulario de restablecimiento de contraseña que es <code>password_reset_form.html</code>.</p>
<p>FICHERO: <code>templates/registration/password_reset_form.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block title %}¿Olvidó su contraseña?{% endblock %}

{% block content %}
&lt;h1&gt;¿Olvidó su contraseña?&lt;/h1&gt;
&lt;p&gt;Introduzca su dirección de correo electrónico y recibirá instrucciones para establecer una nueva.&lt;/p&gt;
&lt;form method=&quot;POST&quot;&gt;
  {% csrf_token %}
  {{ form.as_p }}
  &lt;input class=&quot;btn btn-success&quot; type=&quot;submit&quot; value=&quot;¡Envíenme instrucciones!&quot;&gt;
&lt;/form&gt;
{% endblock content %}
</code></pre>
<p>En la parte superior se extiende <code>base.html</code> y se fija el título de la página. Debido a que usamos títulos "block" en el <code>base.html</code> se pueden anular aquí.</p>
<ul>
<li>El formulario usa POST ya que se están enviando datos y un <code>csrf_token</code> por razones de seguridad.</li>
<li>Al usar <code>form.as_p</code> simplemente se está mostrando en párrafos el contenido del formulario de restablecimiento de la contraseña predeterminada.</li>
<li>
<p>Finalmente se incluye un enviar el botón y se usa el estilo de Bootstrap <code>btn btn-success</code> para hacerlo verde.</p>
</li>
<li>
<p>Ahora se puede actualizar las otras tres páginas. Cada una tiene la misma forma de extender
<code>base.html</code>, un nuevo título, un nuevo texto de contenido, y para "password reset confirm" una actualización también.</p>
</li>
</ul>
<p>FICHERO: <code>templates/registration/password_reset_done.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block title %}Correo electrónico enviado{% endblock %}

{% block content %}
  &lt;h1&gt;Compruebe su buzón de correo electrónico.&lt;/h1&gt;
  &lt;p&gt;Se le ha enviado instrucciones para establecer su nueva contraseña.&lt;br&gt;
     ¡Debería recibir el correo electrócino en breve!.&lt;/p&gt;
{% endblock content %}
</code></pre>
<p>Confirmar los cambios en http://127.0.0.1:8000/accounts/password_reset/done/</p>
<p>A continuación, la página de confirmación del restablecimiento de la contraseña.</p>
<p>FICHERO: <code>templates/registration/password_reset_confirm.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block title %}Introducir nueva contraseña{% endblock %}

{% block content %}
&lt;h1&gt;¡Establezca una nueva contraseñá!&lt;/h1&gt;
&lt;form method=&quot;POST&quot;&gt;
  {% csrf_token %}
  {{ form.as_p }}
  &lt;input class=&quot;btn btn-success&quot; type=&quot;submit&quot; value=&quot;Cambiar Contraseña&quot;&gt;
&lt;/form&gt;
{% endblock content %}
</code></pre>
<p>Abrir la linea de comandos y tomar el enlace URL del correo electrónico enviado a la consola.</p>
<p>Finalmente aquí está el código completo para reestablecer el password.</p>
<p>FICHERO: <code>templates/registration/password_reset_complete.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block title %}Restablecimiento de la contraseña completo{% endblock %}

{% block content %}
&lt;h1&gt;Restablecimiento de la contraseña completo&lt;/h1&gt;
&lt;p&gt;Su nueva contraseña se ha reestablecido. Puede logarse ahora en la página de &lt;a href=&quot;{% url 'login' %}&quot;&gt;login&lt;/a&gt;.&lt;/p&gt;
{% endblock content%}
</code></pre>
<h2 id="125-conclusion">12.5. Conclusión</h2>
<p>En el próximo capítulo se conectará <em>Newspaper</em> con el servicio de correo electrónico <em>SendGrid</em> para enviar realmente los correos electrónicos automatizados a los usuarios, en lugar de emitirlos en la consola de línea de comandos.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../13_email/" class="btn btn-neutral float-right" title="13. Email">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../11_bootstrap/" class="btn btn-neutral" title="11. Bootstrap"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../11_bootstrap/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../13_email/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
