<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>14 - Django</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "14";
    var mkdocs_page_input_path = "14.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Django</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../1_introduccion/">1. Introducción</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../2_configuracion_inicial/">2. Configuración Inicial</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../3_hello_world_app/">3. Hello World app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../4_pages_app/">4. Pages app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../5_message_board_app/">5. Message Board app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../6_blog_app/">6. Blog app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../7_formularios/">7. Formularios</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../8_cuentas_de_usuarios/">8. Cuentas de Usuarios</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../9_modelo_de_usuario_personalizado/">9. Modelo de Usuario Personalizado</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../10_autenticacion_de_usuarios/">10. Autenticación de Usuarios</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../11_bootstrap/">11. Bootstrap</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Django</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>14</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Chapter
: Newspaper app
It’s time to build out our Newspaper app. We’ll have an articles page where journalists
can post articles, set up permissions so only the author of an article can edit or delete
it, and finally add the ability for other users to write comments on each article which
will introduce the concept of foreign keys.
Articles app
To start create an articles app and define our database models. There are no hard
and fast rules around what to name your apps except that you can’t use the name
of a built-in app. If you look at the INSTALLED_APPS section of settings.py you can
see which app names are off-limits: admin , auth , contenttypes , sessions , messages ,
and staticfiles . A general rule of thumb is to use the plural of an app name– posts ,
payments , users , etc.–unless doing so is obviously wrong as in the common case of
blog where the singular makes more sense.
Start by creating our new articles app.
Command Line
(news) $ python manage.py startapp articles
Then add it to our INSTALLED_APPS and update the time zone since we’ll be timestamp-
ing our articles. You can find your time zone in this Wikipedia list. For example, I live
in Boston, MA which is in the Eastern time zone of the United States. Therefore my
entry is America/New_York .Chapter 13: Newspaper app
252
Code</p>
<h1 id="newspaper_projectsettingspy">newspaper_project/settings.py</h1>
<p>INSTALLED_APPS = [
'django.contrib.admin',
'django.contrib.auth',
'django.contrib.contenttypes',
'django.contrib.sessions',
'django.contrib.messages',
'django.contrib.staticfiles',</p>
<h1 id="_1"></h1>
<p>rd Party
'crispy_forms',</p>
<h1 id="local">Local</h1>
<p>'users',
'pages',
'articles', # new
]
TIME_ZONE = 'America/New_York'
Next up we define our database model which contains four fields: title , body , date ,
and author . Note that we’re letting Django automatically set the time and date based
on our TIME_ZONE setting. For the author field we want to reference our custom user
model 'users.CustomUser' which we set in the settings.py file as AUTH_USER_MODEL .
Therefore if we import settings we can refer to it as settings.AUTH_USER_MODEL .
We also implement the best practices of defining a get_absolute_url from the
beginning and a <strong>str</strong> method for viewing the model in our admin interface.253
Chapter 13: Newspaper app
Code</p>
<h1 id="articlesmodelspy">articles/models.py</h1>
<p>from django.conf import settings
from django.db import models
from django.urls import reverse
class Article(models.Model):
title = models.CharField(max_length=
)
body = models.TextField()
date = models.DateTimeField(auto_now_add=True)
author = models.ForeignKey(
settings.AUTH_USER_MODEL,
on_delete=models.CASCADE,
)
def <strong>str</strong>(self):
return self.title
def get_absolute_url(self):
return reverse('article_detail', args=[str(self.id)])
Since we have a brand new app and model, it’s time to make a new migration file and
then apply it to the database.Chapter 13: Newspaper app
254
Command Line
(news) $ python manage.py makemigrations articles
(news) $ python manage.py migrate
At this point I like to jump into the admin to play around with the model before
building out the urls/views/templates needed to actually display the data on the
website. But first we need to update admin.py so our new app is displayed.
Code</p>
<h1 id="articlesadminpy">articles/admin.py</h1>
<p>from django.contrib import admin
from . import models
admin.site.register(models.Article)
Now we start the server.
Command Line
(news) $ python manage.py runserver
Navigate to http://127.0.0.1:8000/admin/ and log in.255
Chapter 13: Newspaper app
Admin page
If you click on “Articles” at the top of the page we can enter in some sample data. You’ll
likely have three users available at this point: your superuser , testuser , and testuser
accounts. Use your superuser account as the author of all three articles.256
Chapter 13: Newspaper app
Admin articles add page
I’ve added three new articles as you can see on the updated Articles page.257
Chapter 13: Newspaper app
Admin three articles
If you click on an individual article you will see that the title , body , and author are
displayed but not the date . That’s because the date was automatically added by Django
for us and therefore can’t be changed in the admin. We could make the date editable–
in more complex apps it’s common to have both a created_at and updated_at field–but
to keep things simple we’ll just have the date be set upon creation by Django for us
for now. Even though date is not displayed here we will still be able to access it in our
templates so it can be displayed on web pages.
URLs and Views
The next step is to configure our URLs and views. Let’s have our articles appear at
articles/ . Import include on the second line and add a URL pattern for articles in
our project-level urls.py file.Chapter 13: Newspaper app
258
Code</p>
<h1 id="newspaper_projecturlspy">newspaper_project/urls.py</h1>
<p>from django.contrib import admin
from django.urls import path, include # new
urlpatterns = [
path('', include('pages.urls')),
path('articles/', include('articles.urls')), # new
path('admin/', admin.site.urls),
path('users/', include('users.urls')),
path('users/', include('django.contrib.auth.urls')),
]
Next we create an articles/urls.py file.
Command Line
(news) $ touch articles/urls.py
Then populate it with our routes. Let’s start with the page to list all articles at
articles/ which will use the view ArticleListView .Chapter 13: Newspaper app
259
Code</p>
<h1 id="articlesurlspy">articles/urls.py</h1>
<p>from django.urls import path
from . import views
urlpatterns = [
path('', views.ArticleListView.as_view(), name='article_list'),
]
Now create our view using the built-in generic ListView from Django.
Code</p>
<h1 id="articlesviewspy">articles/views.py</h1>
<p>from django.views.generic import ListView
from . import models
class ArticleListView(ListView):
model = models.Article
template_name = 'article_list.html'
The only two fields we need to specify are the model Article and our template name
which will be article_list.html .
The last step is to create our template. We can make an empty file from the command
line.Chapter 13: Newspaper app
260
Command Line
(news) $ touch templates/article_list.html
Bootstrap has a built-in component called Cards that we can customize for our
individual articles. Recall that ListView returns an object called object_list which
we can iterate over using a for loop.
Within each article we display the title, body, author, and date. We can even provide
links to “edit” and “delete” functionality that we haven’t built yet.
Code
<!-- templates/article_list.html -->
{% extends 'base.html' %}
{% block title %}Articles{% endblock %}
{% block content %}
{% for article in object_list %}
<div class="card">
<div class="card-header">
<span class="font-weight-bold">{{ article.title }}</span> &middot;
<span class="text-muted">by {{ article.author }} | {{ article.date }}</s\
pan>
</div>
<div class="card-body">
{{ article.body }}
</div>
<div class="card-footer text-center text-muted">
<a href="#">Edit</a> | <a href="#">Delete</a>261
Chapter 13: Newspaper app
</div>
</div>
<br />
{% endfor %}
{% endblock content %}
Spin up the server again with python manage.py runserver and check out our page at
http://127.0.0.1:8000/articles/.
Articles page
Not bad eh? If we wanted to get fancy we could create a custom template filter so
that the date outputted is shown in seconds, minutes, or days. This can be done with
some if/else logic and Django’s date options but we won’t implement it here.262
Chapter 13: Newspaper app
Edit/Delete
How do we add edit and delete options? We need new urls, views, and templates. Let’s
start with the urls. We can take advantage of the fact that Django automatically adds
a primary key to each database. Therefore our first article with a primary key of
will
be at articles/ /edit/ and the delete route will be at articles/ /delete/ .
Code</p>
<h1 id="articlesurlspy_1">articles/urls.py</h1>
<p>from django.urls import path
from . import views
urlpatterns = [
path('', views.ArticleListView.as_view(), name='article_list'),
path('<int:pk>/edit/',
views.ArticleUpdateView.as_view(), name='article_edit'),</p>
<h1 id="new">new</h1>
<p>path('<int:pk>/',
views.ArticleDetailView.as_view(), name='article_detail'),</p>
<h1 id="new_1">new</h1>
<p>path('<int:pk>/delete/',
views.ArticleDeleteView.as_view(), name='article_delete'),</p>
<h1 id="new_2">new</h1>
<p>]
Now write up our views which will use Django’s generic class-based views for
DetailView , UpdateView and DeleteView . We specify which fields can be updated– title
and body –and where to redirect the user after deleting an article: article_list .Chapter 13: Newspaper app
Code</p>
<h1 id="articlesviewspy_1">articles/views.py</h1>
<p>from django.views.generic import ListView, DetailView
from django.views.generic.edit import UpdateView, DeleteView
from django.urls import reverse_lazy
from . import models
class ArticleListView(ListView):
model = models.Article
template_name = 'article_list.html'
class ArticleDetailView(DetailView):
model = models.Article
template_name = 'article_detail.html'
class ArticleUpdateView(UpdateView):
model = models.Article
fields = ['title', 'body', ]
template_name = 'article_edit.html'
class ArticleDeleteView(DeleteView):
model = models.Article
template_name = 'article_delete.html'
263Chapter 13: Newspaper app
264
success_url = reverse_lazy('article_list')
Finally we need to add our new templates. Stop the server with Control+c and type
the following.
Command Line
(news) $ touch templates/article_detail.html
(news) $ touch templates/article_edit.html
(news) $ touch templates/article_delete.html
We’ll start with the details page which will display the title, date, body, and author
with links to edit and delete. It will also link back to all articles. Recall that the Django
templating language’s url tag wants the URL name and then any arguments passed
in. The name of our edit route is article_edit and we need to pass in its primary
key article.pk . The delete route name is article_delete and it also needs a primary
key article.pk . Our articles page is a ListView so it does not need any additional
arguments passed in.
Code
<!-- templates/article_detail.html -->
{% extends 'base.html' %}
{% block content %}
<div class="article-entry">
<h2>{{ object.title }}</h2>
<p>by {{ object.author }} | {{ object.date }}</p>
<p>{{ object.body }}</p>
</div>Chapter 13: Newspaper app
265
<p><a href="{% url 'article_edit' article.pk %}">Edit</a> | <a href="{% url 'a\
rticle_delete' article.pk %}">Delete</a></p>
<p>Back to <a href="{% url 'article_list' %}">All Articles</a>.</p>
{% endblock content %}
For the edit and delete pages we can use Bootstrap’s button styling to make the edit
button light blue and the delete button red.
Code
<!-- templates/article_edit.html -->
{% extends 'base.html' %}
{% block content %}
<h1>Edit</h1>
<form action="" method="post">{% csrf_token %}
{{ form.as_p }}
<button class="btn btn-info ml- " type="submit">Update</button>
</form>
{% endblock %}Chapter 13: Newspaper app
266
Code
<!-- templates/article_delete.html -->
{% extends 'base.html' %}
{% block content %}
<h1>Delete</h1>
<form action="" method="post">{% csrf_token %}
<p>Are you sure you want to delete "{{ article.title }}"?</p>
<button class="btn btn-danger ml- " type="submit">Confirm</button>
</form>
{% endblock %}
As a final step we can add the edit and delete links to our lists page at the div class for
card-footer... . These will be the same as those added to the detail page.
Code
<!-- templates/article_list.html -->
...
<div class="card-footer text-center text-muted">
<a href="{% url 'article_edit' article.pk %}">Edit</a> |
<a href="{% url 'article_delete' article.pk %}">Delete</a>
</div>
...
Ok, we’re ready to view our work. Start up the server with python manage.py run-
server and navigate to articles page at http://127.0.0.1:8000/articles/. Click on the
link for “edit” on the first article and you’ll be redirected to:
http://127.0.0.1:8000/articles/1/edit/267
Chapter 13: Newspaper app
Edit page
If you update the “title” field and click update you’ll be redirected to the detail page
which shows the new change.
Detail page
If you click on the “Delete” link you’ll be redirected to the delete page.268
Chapter 13: Newspaper app
Delete page
Press the scary red button for “Delete” and you’ll be redirected to the articles page
which now only has two entries.
Articles page two entries
Create page
The final step is a create page for new articles which we can do with Django’s
CreateView . Our three steps are to create a view, url, and template. This flow shouldChapter 13: Newspaper app
269
feel pretty familiar by now.
In our views file add CreateView to the imports at the top and make a new class
ArticleCreateView that specifies our model, template, and the fields available.
Code</p>
<h1 id="articlesviewspy_2">articles/views.py</h1>
<p>...
from django.views.generic.edit import CreateView, UpdateView, DeleteView
class ArticleCreateView(CreateView):
model = models.Article
template_name = 'article_new.html'
fields = ['title', 'body', 'author',]
...
Note that our fields has author since we want to associate a new article with an
author, however once an article has been created we do not want a user to be able
to change the author which is why ArticleUpdateView only has the fields ['title',
'body',] .
Update our urls file with the new route for the view.Chapter 13: Newspaper app
270
Code</p>
<h1 id="articlesurlspy_2">articles/urls.py</h1>
<p>...
urlpatterns = [
...
path('new/', views.ArticleCreateView.as_view(), name='article_new'),
...
]
Then quit the server Control+c to create a new template named article_new.html .
Command Line
(news) $ touch templates/article_new.html
And update it with the following HTML code.
Code
<!-- templates/article_new.html -->
{% extends 'base.html' %}
{% block content %}
<h1>New article</h1>
<form action="" method="post">{% csrf_token %}
{{ form.as_p }}
<button class="btn btn-success ml- " type="submit">Save</button>
</form>
{% endblock %}
As a final step we should add a link to creating new articles in our nav so it is accessible
everywhere on the site to logged-in users.Chapter 13: Newspaper app
271
Code
<!-- templates/base.html -->
...
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark mb- ">
<a class="navbar-brand" href="{% url 'home' %}">Newspaper</a>
{% if user.is_authenticated %}
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a href="{% url 'article_new' %}">+ New</a></li>
</ul>
{% endif %}
<button class="navbar-toggler" type="button" data-toggle="collapse" data-tar\
get="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-\
label="Toggle navigation">
<span class="navbar-toggler-icon"></span>
</button>
...
And why not use Bootstrap to improve our original homepage now too? We can update
templates/home.html as follows.Chapter 13: Newspaper app
272
Code
<!-- templates/home.html -->
{% extends 'base.html' %}
{% block title %}Home{% endblock %}
{% block content %}
<div class="jumbotron">
<h1 class="display- ">Newspaper app</h1>
<p class="lead">A Newspaper website built with Django.</p>
<p class="lead">
<a class="btn btn-primary btn-lg" href="{% url 'article_list' %}" role="butt\
on">View All Articles</a>
</p>
</div>
{% endblock %}
We’re all done. Let’s just confirm everything works as expected. Start up the server
again python manage.py runserver and navigate to our homepage at:
http://127.0.0.1:8000/.273
Chapter 13: Newspaper app
Homepage with new link in nav
Click on the link for “+ New” in the top nav and you’ll be redirected to our create page.274
Chapter 13: Newspaper app
Create page
Go ahead and create a new article. Then click on the “Save” button. You will be
redirected to the detail page. Why? Because in our models.py file we set the get_-
absolute_url method to article_detail . This is a good approach because if we later
change the url pattern for the detail page to, say, articles/details/ / , the redirect
will still work. Whatever route is associated with article_detail will be used; there
is no hardcoding of the route itself.275
Chapter 13: Newspaper app
Detail page
Note also that the primary key here is in the URL. Even though we’re only displaying
three articles right now, Django doesn’t reorder the primary keys just because we
deleted one. In practice, most real-world sites don’t actually delete anything; instead
they “hide” deleted fields since this makes it easier to maintain the integrity of a
database and gives the option to “undelete” later on if needed. With our current
approach once something is deleted it’s gone for good!
Click on the link for “All Articles” to see our new /articles page.276
Chapter 13: Newspaper app
Updated articles page
There’s our new article on the bottom as expected.
Conclusion
We have created a dedicated articles app with CRUD functionality. But there are no
permissions or authorizations yet, which means anyone can do anything! A logged-out
user can visit all URLs and any logged-in user can make edits or deletes to an existing
article, even one that’s not their own! In the next chapter we will add permissions and
authorizations to our project to fix this.</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
