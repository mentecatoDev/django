<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>13 - Django</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "13";
    var mkdocs_page_input_path = "13.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Django</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../1_introduccion/">1. Introducción</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../2_configuracion_inicial/">2. Configuración Inicial</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../3_hello_world_app/">3. Hello World app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../4_pages_app/">4. Pages app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../5_message_board_app/">5. Message Board app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../6_blog_app/">6. Blog app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../7_formularios/">7. Formularios</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../8_cuentas_de_usuarios/">8. Cuentas de Usuarios</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../9_modelo_de_usuario_personalizado/">9. Modelo de Usuario Personalizado</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../10_autenticacion_de_usuarios/">10. Autenticación de Usuarios</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../11_bootstrap/">11. Bootstrap</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Django</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>13</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Chapter
: Email
At this point you may be feeling a little overwhelmed by all the user authentication
configuration we’ve done up to this point. That’s normal. After all, we haven’t even
created any core Newspaper app features yet! Everything has been about setting up
custom user accounts and the rest.
The upside to Django’s approach is that it is incredibly easy to customize any piece of
our website. The downside is Django requires a bit more out-of-the-box code than
some competing web frameworks. As you become more and more experienced in web
development, the wisdom of Django’s approach will ring true.
Now we want to have our emails be actually sent to users, not just outputted to our
command line console. We need to signup for an account at SendGrid and update our
settings.py files. Django will take care of the rest. Ready?
SendGrid
SendGrid is a popular service for sending transactional emails so we’ll use it. Django
doesn’t care what service you choose though; you can just as easily use MailGun or
any other service of your choice.
On the SendGrid homepage click on the large blue button for “See Plans and Pricing”.242
Chapter 12: Email
SendGrid homepage
On the next page scroll down slightly and look on the left side for the “Try for Free”
button. SendGrid provides a free tier we can use although they make it somewhat
difficult to find.243
Chapter 12: Email
SendGrid pricing
Sign up for your free account on the next page.244
Chapter 12: Email
SendGrid new account
Make sure that the email account you use for SendGrid is not the same email account
you have for your superuser account on the Newspaper project or there can be weird
errors.
After confirming your new account via email–that’s kinda meta, no?–you’ll be asked
to login and taken to your SendGrid dashboard page.245
Chapter 12: Email
SendGrid loggedin
Now we can configure our Django code in the settings.py file. First we update the
email backend to use SMTP.
Code</p>
<h1 id="newspaper_projectsettingspy">newspaper_project/settings.py</h1>
<p>EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
Then right below it add the following five lines of email configuration. Note that ideally
you should store secure information like your password in environment variables, but
we won’t here to keep things simple.Chapter 12: Email
246
Code</p>
<h1 id="newspaper_projectsettingspy_1">newspaper_project/settings.py</h1>
<p>EMAIL_HOST = 'smtp.sendgrid.net'
EMAIL_HOST_USER = 'sendgrid_username'
EMAIL_HOST_PASSWORD = 'sendgrid_password'
EMAIL_PORT =
EMAIL_USE_TLS = True
Make sure to use enter your own SendGrid username for EMAIL_HOST_USER and
password for EMAIL_HOST_PASSWORD .
That’s it. We’re done! Navigate to the password reset form again at:
http://127.0.0.1:8000/users/password_reset/
You should receive an email in your inbox! The text will be exactly the same as that
outputted to our command line console previously.
Custom emails
The current email text isn’t very personal, is it? Let’s change things. At this point I
could just show you what steps to take, but I think it’s helpful if I can explain how
I figured out how to do this. After all, you want to be able to customize all parts of
Django as needed.
In this case, I knew what text Django was using by default but it wasn’t clear where
in the Django source code it was written. And since all of Django’s source code is
available on Github we can can just search it.247
Chapter 12: Email
Github Django
Use the Github search bar and enter a few words from the email text. If you type in
“You’re receiving this email because” you’ll end up at this Github search page.
Github search
The first result is the one we want. It shows the code is located at django/contrib/ad-
min/templates/registration/password_reset_email.html . That means in the contrib
app the file we want is called password_reset_email.html .248
Chapter 12: Email
Here is that default text from the Django source code.
Code
{% load i
n %}{% autoescape off %}
{% blocktrans %}You're receiving this email because you requested a password res\
et for your user account at {{ site_name }}.{% endblocktrans %}
{% trans "Please go to the following page and choose a new password:" %}
{% block reset_link %}
{{ protocol }}://{{ domain }}{% url 'password_reset_confirm' uidb
=uid token=to\
ken %}
{% endblock %}
{% trans "Your username, in case you've forgotten:" %} {{ user.get_username }}
{% trans "Thanks for using our site!" %}
{% blocktrans %}The {{ site_name }} team{% endblocktrans %}
{% endautoescape %}
Let’s change it. We need to create a new password_reset_email.html file in our
registration folder.
Command Line
(news) $ touch templates/registration/password_reset_email.html
Then use the following code which tweaks what Django provided by default.Chapter 12: Email
249
Code
<!-- templates/registration/password_reset_email.html -->
{% load i
n %}{% autoescape off %}
{% trans "Hi" %} {{ user.get_username }},
{% trans "We've received a request to reset your password. If you didn't make th\
is request, you can safely ignore this email. Otherwise, click the button below \
to reset your password." %}
{% block reset_link %}
{{ protocol }}://{{ domain }}{% url 'password_reset_confirm' uidb
=uid token=to\
ken %}
{% endblock %}
{% endautoescape %}
This code might look a little scary so let’s break it down line-by-line. Up top we
load the template tag i18n which means this text is eligible to be translated into
multiple languages. Django has robust internationalization support though covering
it is beyond the scope of this book.
We’re greeting the user by name thanks to user.get_username . Then we use the built-
in reset_link block to include the custom URL link. You can read more about Django’s
password management approach in the official docs.
Let’s also update the email’s subject title. To do this we’ll create a new file tem-
plates/registration/password_reset_subject.txt .Chapter 12: Email
250
Command Line
(news) $ touch templates/registration/password_reset_subject.txt
Then add the following line of code to the password_reset_subject.txt file.
Please reset your password
And we’re all set. Go ahead and try out our new flow again by entering a new password
at http://127.0.0.1:8000/users/password_reset/. Then check your email and it will
have our new content and subject.
Conclusion
We’ve now finished implementing a complete user authentication flow. Users can sign
up for a new account, login, logout, change their password, and reset their password.
It’s time to build out our actual Newspaper app.</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
