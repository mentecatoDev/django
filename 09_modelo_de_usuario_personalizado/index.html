<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>9. Modelo de Usuario Personalizado - Django</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "9. Modelo de Usuario Personalizado";
    var mkdocs_page_input_path = "09_modelo_de_usuario_personalizado.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Django</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../por_que_django/">¿Por qué Django?</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../01_introduccion/">1. Introducción</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../02_configuracion_inicial/">2. Configuración Inicial</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../03_hello_world_app/">3. Hello World app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../04_pages_app/">4. Pages app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../05_message_board_app/">5. Message Board app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../06_blog_app/">6. Blog app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../07_formularios/">7. Formularios</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../08_cuentas_de_usuarios/">8. Cuentas de Usuarios</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">9. Modelo de Usuario Personalizado</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#9-modelo-de-usuario-personalizado">9. Modelo de usuario personalizado</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#91-setup">9.1. Setup</a></li>
        
            <li><a class="toctree-l3" href="#92-modelo-de-usuario-personalizado">9.2 Modelo de usuario personalizado</a></li>
        
            <li><a class="toctree-l3" href="#93-formularios">9.3. Formularios</a></li>
        
            <li><a class="toctree-l3" href="#94-superusuario">9.4. Superusuario</a></li>
        
            <li><a class="toctree-l3" href="#95-conclusion">9.5. Conclusión</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../10_autenticacion_de_usuarios/">10. Autenticación de Usuarios</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../11_bootstrap/">11. Bootstrap</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../12_cambio_y_restauracion_de_contrasenas/">12. Cambio y Restauración de Contraseñas</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../13_email/">13. Email</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../14_newspaper_app/">14. Newspaper app</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../15_permisos_y_autorizacion/">15. Permisos y Autorización</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../16_comentarios/">16. Comentarios</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Django</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>9. Modelo de Usuario Personalizado</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="9-modelo-de-usuario-personalizado">9. Modelo de usuario personalizado</h1>
<ul>
<li>La documentación oficial de Django recomienda encarecidamente utilizar un <strong>modelo de usuario personalizado</strong> para los nuevos proyectos. La razón es que si se quiere hacer cualquier cambio en el modelo de usuario en el futuro -por ejemplo, añadiendo un campo de edad- utilizar un modelo de usuario personalizado desde el principio lo convierte en algo sencillo. Pero si no se crea un modelo de usuario personalizado, actualizar el modelo de usuario por defecto en un proyecto Django existente es muy, <strong>muy difícil</strong>.</li>
<li>Sin embargo, el ejemplo de la documentación oficial no es realmente lo que muchos expertos de Django recomiendan. Utiliza el complejo <code>AbstractBaseUser</code> cuando si sólo se utiliza <code>AbstractUser</code> las cosas son mucho más sencillas y aún así personalizables.</li>
<li>Hagamos un periódico (homenaje a las raíces de Django como un framework construido para editores y periodistas en el <a href="https://en.wikipedia.org/wiki/Lawrence_Journal-World">Lawrence Journal-World</a>).</li>
</ul>
<h2 id="91-setup">9.1. Setup</h2>
<pre><code class="bash">$ cd ~/Desktop
$ mkdir news
$ cd news
$ pipenv install django
$ pipenv shell
(news) $ django-admin startproject newspaper_project .
(news) $ python manage.py startapp users
(news) $ python manage.py runserver
</code></pre>

<ul>
<li>Tener en cuenta que aún <strong>no se ha ejecutado la migración</strong> para configurar la base de datos.<ul>
<li>Es importante <strong>esperar hasta después</strong> de que se haya creado el nuevo modelo de usuario personalizado antes de hacerlo, dado lo estrechamente conectado que está el modelo de usuario con el resto de Django.</li>
</ul>
</li>
</ul>
<h2 id="92-modelo-de-usuario-personalizado">9.2 Modelo de usuario personalizado</h2>
<ul>
<li>La creación de nuestro modelo de usuario personalizado requiere cuatro pasos:<ul>
<li>Actualizar <code>settings.py</code></li>
<li>Crear un nuevo modelo <code>CustomUser</code> añadiendo un nuevo campo <code>age</code></li>
<li>Crear nuevos formularios para <code>UserCreation</code> y <code>UserChangeForm</code></li>
<li>Actualizar el admin</li>
</ul>
</li>
</ul>
<p>FICHERO: <code>newspaper_project/settings.py</code></p>
<pre><code class="python">INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'users', # new
]
...
AUTH_USER_MODEL = 'users.CustomUser' # new
</code></pre>

<p>FICHERO: <code>users/models.py</code></p>
<pre><code class="python">from django.contrib.auth.models import AbstractUser
from django.db import models


class CustomUser(AbstractUser):
    age = models.PositiveIntegerField(default=0)
</code></pre>

<h2 id="93-formularios">9.3. Formularios</h2>
<ul>
<li>Hay dos formas de interactuar con el nuevo modelo de Usuario Personalizado<ul>
<li>Cuando un usuario se registra para una nueva cuenta en el sitio web</li>
<li>Dentro de la aplicación de administración que permite, como superusuarios, modificar los usuarios existentes.</li>
</ul>
</li>
<li>Así que hay que actualizar los dos formularios incorporados para esta funcionalidad: <code>UserCreationForm</code> y <code>UserChangeForm</code>.</li>
</ul>
<pre><code class="bash">(noticias) $ touch users/forms.py
</code></pre>

<p>FICHERO: <code>users/forms.py</code></p>
<pre><code class="python">from django import forms
from django.contrib.auth.forms import UserCreationForm, UserChangeForm
from .models import CustomUser


class CustomUserCreationForm(UserCreationForm):

    class Meta(UserCreationForm.Meta):
        model = CustomUser
        fields = UserCreationForm.Meta.fields


class CustomUserChangeForm(UserChangeForm):

    class Meta:
        model = CustomUser
        fields = UserChangeForm.Meta.fields
</code></pre>

<ul>
<li>Para ambos formularios se usa el modelo <code>CustomUser</code> con los campos por defecto de <code>Meta.fields</code>.</li>
<li>El modelo de <code>CustomUser</code> contiene todos los campos del modelo de usuario por defecto y el campo <code>age</code> adicional que se ha definido.</li>
<li>¿Pero cuáles son estos campos por defecto?<ul>
<li>Resulta que hay muchos, incluyendo <code>username</code>, <code>first_name</code>, <code>last_name</code>, <code>email</code>, <code>password</code>, <code>groups</code> y más.</li>
<li>Sin embargo, cuando un usuario se registra en una nueva cuenta en Django, el formulario predeterminado sólo pide un nombre de usuario, un correo electrónico y una contraseña.</li>
<li>Esto nos dice que la configuración predeterminada para los campos en <code>UserCreationForm</code> son sólo el <code>username</code>,  <code>email</code> y <code>password</code>aunque hay muchos más campos disponibles.</li>
<li>Por tanto, entender los formularios y los modelos correctamente lleva algún tiempo.</li>
</ul>
</li>
<li>El paso final es actualizar el archivo <code>admin.py</code> ya que <em>Admin</em> está estrechamente unido al modelo de Usuario por defecto. Se extenderá la clase existente <code>UserAdmin</code> para usar el nuevo modelo de <code>CustomUser</code> y los dos nuevos formularios.
FICHERO: <code>users/admin.py</code></li>
</ul>
<pre><code class="python">from django.contrib import admin
from django.contrib.auth.admin import UserAdmin
from .forms import CustomUserCreationForm, CustomUserChangeForm
from .models import CustomUser


class CustomUserAdmin(UserAdmin):
    add_form = CustomUserCreationForm
    form = CustomUserChangeForm
    list_display = ['email', 'username', 'age']
    model = CustomUser

admin.site.register(CustomUser, CustomUserAdmin)
</code></pre>

<ul>
<li>Obsérvese que <code>CustomUserAdmin</code> también tiene un ajuste de <code>list_display</code> de manera que sólo muestra los campos de <code>email</code> , <code>username</code> y <code>age</code> aunque de hecho hay muchos más en el modelo de <code>CustomUser</code></li>
<li>Ejecutar <code>makemigrations</code> y <code>migrate</code> por primera vez para crear una nueva base de datos que utilice el modelo de usuario personalizado.</li>
</ul>
<pre><code class="bash">(news) $ python manage.py makemigrations
(news) $ python manage.py migrate
</code></pre>

<h2 id="94-superusuario">9.4. Superusuario</h2>
<p>Vamos a crear una cuenta de superusuario para confirmar que todo funciona como se espera. En la línea de comandos, escriba el siguiente comando y pase a través de las indicaciones.</p>
<pre><code class="bash">(news) $ python manage.py createsuperuser
</code></pre>

<ul>
<li>El hecho de que esto funcione es la primera prueba de que el modelo de usuario personalizado funciona como se esperaba.</li>
<li>Navegar a http://127.0.0.1:8000/admin, logear y probar.</li>
</ul>
<h2 id="95-conclusion">9.5. Conclusión</h2>
<p>Con el modelo de usuario personalizado completo, ahora podemos centrarnos en construir el resto de la aplicación <em>Periódico</em>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../10_autenticacion_de_usuarios/" class="btn btn-neutral float-right" title="10. Autenticación de Usuarios">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../08_cuentas_de_usuarios/" class="btn btn-neutral" title="8. Cuentas de Usuarios"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../08_cuentas_de_usuarios/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../10_autenticacion_de_usuarios/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
